<!DOCTYPE html>
<html>
  <head>
    <!-- <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/ > -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>
    

    <script src="https://d3js.org/d3.v4.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>


    <style>

      /*#chartdiv {
        width: 100%;
        height: 600px;
      }*/

      body { background-color: #30303d; color: #fff; }

      #mapid { 
        height: 75vh; 
        width: 100%;
        position: center;
      }

     /* .ticks {
        font-size: 20px;
        fill: #fff;
        stroke: #fff;

      }*/
      .ticks line{
        stroke: white;
      }

      .ticks text{
        fill: white;
        font-size: 20px;
      }

      .track,
      .track-inset,
      .track-overlay {
        stroke-linecap: round;

      }

      .track {
        stroke: #000;
        stroke-opacity: 0.3;
        stroke-width: 10px;
      }

      .track-inset {
        stroke: #dcdcdc;
        stroke-width: 8px;
      }

      .track-overlay {
        pointer-events: stroke;
        stroke-width: 50px;
        stroke: transparent;
        cursor: crosshair;

      }

      .handle {
        fill: #fff;
        stroke: #000;
        stroke-opacity: 0.5;
        stroke-width: 1.25px;
      }

    </style>
  
  </head>
  <body>

    <nav class="navbar navbar-inverse">
      <div class="container-fluid">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">WPI IQP Data</a>
        </div>
        <ul class="nav navbar-nav">
          <li class="active"><a href="index.html">Sponsors</a></li>
          <li><a href="climateChange.html">Climate Change</a></li>
        </ul>
      </div>
    </nav>

    <div class="col-sm-8" id="chartdiv">
      <div id="mapid"></div>
    </div>
    <div class="col-sm-4" id="timeline">
      
    </div>
    

    <br>
    <br>

    <div class="col-sm-12">
      <h1 id="sponsorTitle" style="text-align: center;">Click on a country to find out about past IQP sponsors</h1>
    </div>

    <div class="col-sm-12" id="sponsorList">

    </div>
    
    

    <script>

      projectCenters = {
        "Melbourne, Australia": [-37.8136, 144.9631],
        "London, England": [51.5074, -0.1278],
        "Venice, Italy": [45.4408, 12.3155],

        "Worcester Community Project Center": [41.2626, -70.8023],

        "Hong Kong, China": [22.3193, 114.1694],
        "Washington, DC": [38.9072, -77.0369],
        "Namibia": [-22.9576, 18.4904],
        "Cape Town, South Africa": [-33.9249, 18.4241],
        "San Jose, Costa Rica": [9.9281, -84.0907],
        "Copenhagen, Denmark": [55.6761, 12.5683],
        "Bangkok, Thailand": [13.7563, 100.5018],
        "Costa Rica": [9.7489, -83.7534],
        "New Zealand": [-40.9006, 174.8860],
        "Sante Fe, New Mexico": [35.6870, -105.9378],
        "Boston, Massachusetts": [42.3601, -71.0589],
        "Worcester, MA": [42.2626, -71.8023],
        "Puerto Rico": [18.2208, -66.5901],
        "Nantucket, Massachusetts": [41.2835, -70.0995],
        "Morocco": [31.7917, -7.0926],
        "Zurich, Switzerland": [47.3769, 8.5417],
        "Windhoek, Namibia": [-22.5609, 17.0658],
        "San Juan, Puerto Rico": [18.4655, -66.1057],
        "India": [20.5937, 78.9629],
        "Bar Harbor, Maine": [44.3876, -68.2039],
        "Albania": [41.1533, 20.1683],
        "Russia": [61.5240, 105.3188],
        "Hangzhou, China": [30.2741, 120.1551],
        "Panama City, Panama": [8.9824, -79.5199],

        "Microsoft Corporation": [0, 0],

        "Ifrane, Morocco": [33.5228, -5.1110],

        "WORC / Worcester Community Project Center": [43.2626, -72.8023],

        "Wuhan, China": [30.5928, 114.3055],
        "Japan (Multiple Cities)": [36.2048, 138.2529],
        "Lille, France": [50.6292, 3.0573],
        "Beijing, China": [39.9042, 116.4074],
        "Darmstadt, Germany": [49.8728, 8.6512],

        "Pioneer Valley Econ Dev": [10, 10],

        "Shanghai, China": [31.2304, 121.4737],
        "N/A": [80, 80]
      }
      

      var mymap = L.map('mapid').setView([30, 10], 2);

      var popup = L.popup();


    


      

      sponsorInfo = {};


      d3.csv("allCleaned.csv", function(data) {
        console.log(data);
        
        data.forEach(function(info){

          if(sponsorInfo[info.Center]){
            sponsorInfo[info.Center][0].data.push({"sponsor": info.Sponsor, "center": info.Center, "date": info.Date});
          }
          else{
            sponsorInfo[info.Center] = [{"data": [{"sponsor": info.Sponsor, "center": info.Center, "date": info.Date}], "location": projectCenters[info.Center]}];
          }

          
        })

        console.log(sponsorInfo)

        createMap();
        
      });



      function createMap(){
        

        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
          attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
          maxZoom: 18,
          id: 'mapbox.satellite',
          accessToken: 'pk.eyJ1IjoiamFzb25hYmVsMTIzIiwiYSI6ImNqenNubWRnbDFibTQzbm1pOTNxbTIxemoifQ.9BZFzS-MQts7O6aGIoEqTw'
        }).addTo(mymap);




        Object.keys(sponsorInfo).forEach(function(key) {
          // console.log(key, sponsorInfo[key]);

          var marker = L.marker(sponsorInfo[key][0].location).addTo(mymap).bindPopup(key);

          marker.on('mouseover', showPopup);
          marker.on('mouseout', hidePopup);
          marker.on('click', function clickedPopup(e,){
            this.openPopup();
            updateTable(key, sponsorInfo[key][0].data);
          });
         
        })


      }

      function showPopup(){
        this.openPopup();
      }

      function hidePopup(){
        this.closePopup();
      }

      



      function updateTable(country, sponsorCenterInfo){

        var title = document.getElementById("sponsorTitle");
        title.innerHTML = "Sponsors for projects in " + country;


        var tableRef = document.getElementById("sponsorList");
        tableRef.innerHTML = "";

        console.log(sponsorCenterInfo)

        var centerTitle = document.createElement("H3");
        centerTitle.setAttribute('style', 'text-align: center');
        centerTitle.innerHTML = country;
        tableRef.appendChild(centerTitle)

        var table = document.createElement("TABLE");
        table.setAttribute('class', 'table table-bordered');
        tableRef.appendChild(table)

        sponsors = []

        sponsorCenterInfo.forEach(function(data) {

          center = data.center;
          sponsors.push(data.sponsor);
        });

        sponsors.sort();
        sponsors = [...new Set(sponsors)];


        for(var i = 0; i < sponsors.length; i+=6){
          // Insert a row at the end of the table
          var newRow = table.insertRow(-1);

          // Insert a cell in the row at index 0
          var newCell1 = newRow.insertCell(0);
          var newCell2 = newRow.insertCell(1);
          var newCell3 = newRow.insertCell(2);
          var newCell4 = newRow.insertCell(3);
          var newCell5 = newRow.insertCell(4);
          var newCell6 = newRow.insertCell(5);

          // Append a text node to the cell



          if(sponsors[i] == null){
            var newText1 = document.createTextNode("");
          }
          else{
            var newText1 = document.createTextNode(sponsors[i]);
          }

          if(sponsors[i+1] == null){
            var newText2 = document.createTextNode("");
          }
          else{
            var newText2 = document.createTextNode(sponsors[i+1]);
          }

          if(sponsors[i+2] == null){
            var newText3 = document.createTextNode("");
          }
          else{
            var newText3 = document.createTextNode(sponsors[i+2]);
          }

          if(sponsors[i+3] == null){
            var newText4 = document.createTextNode("");
          }
          else{
            var newText4 = document.createTextNode(sponsors[i+3]);
          }

          if(sponsors[i+4] == null){
            var newText5 = document.createTextNode("");
          }
          else{
            var newText5 = document.createTextNode(sponsors[i+4]);
          }

          if(sponsors[i+5] == null){
            var newText6 = document.createTextNode("");
          }
          else{
            var newText6 = document.createTextNode(sponsors[i+5]);
          }

          newCell1.appendChild(newText1);
          newCell2.appendChild(newText2);
          newCell3.appendChild(newText3);
          newCell4.appendChild(newText4);
          newCell5.appendChild(newText5);
          newCell6.appendChild(newText6);
        }

        
      }
      
    </script>
    <script src="slider.js"></script>
    
  </body>
</html>